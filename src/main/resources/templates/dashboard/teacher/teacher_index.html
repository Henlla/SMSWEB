<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{dashboard/index}">
<head>
    <meta charset="UTF-8">
    <title>Danh sách giáo viên</title>
    <link rel="stylesheet" href="/plugins/toastr/toastr.min.css">
    <link rel="stylesheet" href="/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
    <link rel="stylesheet" href="/css/teacher_details.css">
</head>
<body>
<div layout:fragment="content">
    <section>
        <div class="content-wrapper">
            <div class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h5 class="m-0">Quản lý giáo viên</h5>
                        </div>
                    </div>
                </div>
            </div>
            <div class="content-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <a th:href="@{'/dashboard/create-teacher'}" class="btn btn-info btn-sm">Thêm mới</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <table id="student-table" class="table table-bordered">
                                <thead>
                                <tr class="text-center">
                                    <th>Hình ảnh</th>
                                    <th>Tên giáo viên</th>
                                    <th>Hành động</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr class="text-center" th:each="teacher:${teachers}">
                                    <td><img th:src="${teacher.getProfileByProfileId().getAvartarUrl()}" alt="" width="100"
                                             height="100"></td>
                                    <td><span
                                            th:text="${teacher.profileByProfileId.firstName +' '+teacher.profileByProfileId.lastName}"></span>
                                    </td>
                                    <td class="text-center">
                                        <a class="mr-3" th:data-name="${teacher.id}" onclick="OnDetails(this.getAttribute('data-name'))"><i class="fas fa-eye indigo-text"></i></a>
                                        <a class="mr-3" th:href="@{'/dashboard/teacher_update/' + ${teacher.id}}"><i class="fas fa-pencil-alt"></i></a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="teacher_details" tabindex="-1"
                 aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Chi tiết giáo viên</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <i class="fas fa-times fa-sm"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="container">
                                <div class="row">
                                    <div class="col-3">
                                        <img id="tc_image" width="200" height="200">
                                    </div>
                                    <div class="col-9">
                                        <div class="row">
                                            <div class="col-6">
                                                <label>Họ và tên : </label>&nbsp;<span
                                                    id="tc_fullName"></span>
                                            </div>
                                            <div class="col-6">
                                                <label>Ngày sinh : </label>&nbsp;<span
                                                    id="tc_dob"></span>
                                            </div>
                                            <div class="col-6">
                                                <label>Số điện thoại : </label>&nbsp;<span
                                                    id="tc_phone"></span>
                                            </div>
                                            <div class="col-6">
                                                <label>Email : </label>&nbsp;<span
                                                    id="tc_email"></span>
                                            </div>
                                            <div class="col-6">
                                                <label>CCCD/CMND : </label>&nbsp;<span
                                                    id="tc_identityId"></span>
                                            </div>
                                            <div class="col-12">
                                                <label>Địa chỉ : </label>&nbsp;<span
                                                    id="tc_address"></span>
                                            </div>
                                            <div class="col-12">
                                                <label>Dạy lớp : </label>&nbsp;<span
                                                    id="tc_class"></span>
                                            </div>
                                            <div class="col-12">
                                                <div id="spinner-div" class="pt-5">
                                                    <div class="spinner-border text-primary" role="status">
                                                    </div>
                                                </div>
                                                <input type="hidden" id="accountId" value="">
                                                <input type="hidden" id="email" value="">
                                                <button id="reset_password" class="btn btn-info btn-sm">Đặt lại mật khẩu</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal"><i
                                    class="fas fa-times"></i> Đóng
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
<th:block layout:fragment="optional">
    <script src="/plugins/jquery/jquery.min.js"></script>
    <script src="/plugins/select2/js/select2.full.js"></script>
    <script src="/plugins/toastr/toastr.min.js"></script>
    <script src="/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
    <script src="/plugins/datatables/jquery.dataTables.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#student-table').DataTable({
                "oLanguage": {
                    "sSearch": "Tìm kiếm :"
                },
                "lengthMenu": [5, 10, 25, 50, 75, 100],
            })

            $('.dataTables_filter input[type="search"]').css(
                {'width':'350px','display':'inline-block'}
            );

            $('#reset_password').on('click',()=>{
                Confirm('Đặt lại mật khẩu', 'Có chắc chắn muốn đặt lại mật khẩu?', 'Có', 'Không')
            })
            function Confirm(title, msg, $true, $false) { /*change*/
                var $content =  "<div class='dialog-ovelay'>" +
                    "<div class='dialog'><header>" +
                    " <h3> " + title + " </h3> " +
                    "<i class='fa fa-close'></i>" +
                    "</header>" +
                    "<div class='dialog-msg'>" +
                    " <p> " + msg + " </p> " +
                    "</div>" +
                    "<footer>" +
                    "<div class='controls'>" +
                    " <button class='button button-danger doAction'>" + $true + "</button> " +
                    " <button class='button button-default cancelAction'>" + $false + "</button> " +
                    "</div>" +
                    "</footer>" +
                    "</div>" +
                    "</div>";
                $('body').prepend($content);
                $('.doAction').click(function () {
                    var data = new FormData();
                    data.append("id",$('#accountId').val());
                    data.append("email",$('#email').val());
                    $('#spinner-div').show()
                    $.ajax({
                        url:"/dashboard/teacher/reset_password",
                        method:"POST",
                        cache : false,
                        processData: false,
                        contentType: false,
                        data:data,
                        success:(data)=>{
                            console.log(data)
                        },
                        complete:()=>{
                            toastr.success('Đặt lại mật khẩu thành công')
                            $('#spinner-div').hide()
                        }
                    })
                    $(this).parents('.dialog-ovelay').fadeOut(500, function () {
                        $(this).remove();
                    })
                });
                $('.cancelAction, .fa-close').click(function () {
                    $(this).parents('.dialog-ovelay').fadeOut(500, function () {
                        $(this).remove();
                    });
                });

            }
        });
        var OnDetails = (id) => {
            $.ajax({
                url: "/dashboard/teacher_details/" + id,
                dataType: "json",
                contentType: "application/json",
                method: "GET",
                success: (data) => {
                    console.log(data)
                    $('#tc_image').attr('src',data.profileByProfileId.avartarUrl)
                    $('#tc_fullName').html(data.profileByProfileId.firstName+' '+data.profileByProfileId.lastName)
                    $('#tc_dob').html(data.profileByProfileId.dob)
                    $('#tc_phone').html(data.profileByProfileId.phone)
                    $('#tc_email').html(data.profileByProfileId.email)
                    $('#tc_identityId').html(data.profileByProfileId.identityCard)
                    if(data.teacherClass.length === 0){
                        $('#tc_class').html("Chưa có")
                    }else{
                        for(var classes of data.teacherClass){
                            $('#tc_class').html(classes.classCode)
                        }
                    }
                    $('#tc_address').html(data.profileByProfileId.address+' , '+data.profileByProfileId.wardByWardId.name+' , '+data.profileByProfileId.districtByDistrictId.name+' , '+data.profileByProfileId.profileProvince.name)
                    $('#accountId').val(data.profileByProfileId.accountByAccountId.id)
                    $('#email').val(data.profileByProfileId.email)
                    $("#teacher_details").modal("show");
                }, error: (data) => {
                    console.log(data);
                }
            });
        }
    </script>
</th:block>
</body>
</html>
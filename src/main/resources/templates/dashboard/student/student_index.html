<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{dashboard/index}">
<head>
    <meta charset="UTF-8">
    <title>Danh sách sinh viên</title>
    <style>

    </style>
</head>
<body>
<div layout:fragment="content">
    <section>
        <div class="content-wrapper">
            <div class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h5 class="m-0">Quản lý sinh viên</h5>
                        </div>
                    </div>
                </div>
            </div>
            <div class="content-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <a th:href="@{'/dashboard/create-student'}" class="btn btn-info btn-sm">Thêm mới</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <label>Tìm kiếm theo nghành học :</label>
                            <div id="select-major"></div>
                            <table id="student-table" class="table table-bordered">
                                <thead>
                                <tr class="text-center">
                                    <th>Hình ảnh</th>
                                    <th>Mã sinh viên</th>
                                    <th>Tên sinh viên</th>
                                    <th>Nghành học</th>
                                    <th>Hành động</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr class="text-center" th:each="student:${students}">
                                    <td><img th:src="${student.studentByProfile.getAvartarUrl()}" alt="" width="100"
                                             height="100"></td>
                                    <td><span
                                            th:text="${student.studentByProfile.firstName +' '+student.studentByProfile.lastName}"></span>
                                    </td>
                                    <td><span th:text="${student.studentCard}"></span></td>
                                    <td>
                                        <th:block th:each="major :${student.majorStudentsById}">
                                            [[${major.majorByMajorId.majorName}]]
                                        </th:block>
                                    </td>
                                    <td class="text-center">
                                        <a class="mr-3" th:href="@{'/dashboard/student_details/' + ${student.id}}"><i class="fas fa-eye indigo-text"></i></a>
                                        <a class="mr-3" th:href="@{'/dashboard/student_update/' + ${student.id}}"><i class="fas fa-pencil-alt"></i></a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
<th:block layout:fragment="optional">
    <script src="/plugins/jquery/jquery.min.js"></script>
    <script src="/plugins/select2/js/select2.full.js"></script>
    <script src="/plugins/datatables/jquery.dataTables.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#student-table').DataTable({
                "oLanguage": {
                    "sSearch": "Tìm kiếm :"
                },
                "lengthMenu": [5, 10, 25, 50, 75, 100],
                initComplete: function () {
                    count = 0;
                    this.api().columns([3]).every(function (i) {
                        var title = this.header();
                        //replace spaces with dashes
                        title = $(title).html().replace(/[\W]/g, '');
                        var column = this;
                        var select = $('<select id="' + title + '" class="form-control form-control-sm select2" style="width: 50%" ></select>')
                            .appendTo($('#select-major'))
                            .on('change', function () {
                                //Get the "text" property from each selected data
                                //regex escape the value and store in array
                                var data = $.map($(this).select2('data'),
                                    function (value, key) {
                                        return value.text ? '^' + $.fn.dataTable.util.escapeRegex(value.text) + '$' : null;
                                    });
                                //if no data selected use ""
                                if (data.length === 0) {
                                    data = [""];
                                }
                                //join array into string with regex or (|)
                                var val = data.join('|');
                                //search for the option(s) selected
                                column
                                    .search(val ? val : '', true, false)
                                    .draw();
                            });

                        column.data().unique().sort().each(function (d, j) {
                            select.append('<option value="' + d + '">' + d + '</option>');
                        });
                        //use column title as selector and placeholder
                        $('#' + title).select2({
                            closeOnSelect: true,
                            placeholder: "- All -",
                            allowClear: true,
                            width: 'resolve'
                        });

                        //initially clear select otherwise first option is selected
                        $('.select2').val(null).trigger('change');
                    });
                },
            })

            $('.dataTables_filter input[type="search"]').css(
                {'width':'350px','display':'inline-block'}
            );
        });
    </script>
</th:block>
</body>
</html>